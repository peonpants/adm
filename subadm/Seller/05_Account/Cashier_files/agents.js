var TeG=TeG||{};TeG.Agents=function(){return{Show:function(){$("#body-pane-loader").hide();$("#body-pane-content").show();TeG.Utils().searchBehaivor($("#GlobalSearchEdit"),function(){customerAccountListManager.RefreshGrid()});$("#addNewAgentTool").on("click",function(){TeG.Agents().Add().Show()});$("#printAgentList").on("click",function(){var n=new TeG.Print("AgentsGrid");n.Storage().Open()})},Add:function(){return{Show:function(){function n(){var n=tegGeoApi.getIsoCode();$.each($("#addAgentCountry").find("option"),function(t,i){$(i).attr("data-countryisocode")==n&&($(i).attr("selected","selected"),$("#addAgentMobilePrefix").text($(i).attr("data-phonecode")),$("#addAgentSendSMS").val($(i).attr("data-phonecode").replace(/\+|\s/g,"")))})}$.ajax({type:"POST",url:tegUrlHelper.addAgentTab,contentType:"application/json; charset=utf-8",dataType:"html",error:function(n){tegErrorHandler.processError(n)},success:function(t){$("#addAgent").html(t.replace(/(.*?\r?\n?)*?(\<.*)/,"$2"));TeG.Agents().Add().Validate().Common();n();$("#DivAgentsGrid").hide();$("#addRemoveAgents").show();$("#addAgent").show();$("#backToAgentsGrid").on("click",function(){TeG.Agents().Add().Hide()});$("#addAgentCountry").on("change",function(){$("#addAgentMobilePrefix").text($("#addAgentCountry").find(":selected").attr("data-phonecode"));var n=$("#addAgentMobileNumber").val();n?$("#addAgentSendSMS").val($("#addAgentCountry").find(":selected").attr("data-phonecode").replace(/\+|\s/g,"")+n):$("#addAgentSendSMS").val($("#addAgentCountry").find(":selected").attr("data-phonecode").replace(/\+|\s/g,""))});$('#addAgent[name="addAgentAutoPassword"]').on("click",function(){$('#addAgent[name="addAgentAutoPassword"]').is(":checked")?($('#addAgent[name="addAgentPassword"]').off(),$('#addAgent[name="addAgentConfirmPassword"]').off(),$(".nAgentPassword .errorMessage").remove(),$(".nAgentPassword .error").removeClass("error"),$(".nAgentPassword").slideUp("slow",function(){splitterResize()})):(TeG.Agents().Add().Validate().Password(),$(".nAgentPassword").slideDown("slow",function(){splitterResize()}))});$("#addAgentEmail").on("keyup",function(){$("#addAgentSendEmail").val($("#addAgentEmail").val())});$("#addAgentMobileNumber").on("keyup",function(){$("#addAgentSendSMS").val($("#addAgentMobilePrefix").text().replace(/\+|\s/g,"")+$("#addAgentMobileNumber").val())});$("#addAgentSendEmailCheckBox").on("click",function(){if($("#addAgentSendEmailCheckBox").is(":checked")){$("#addAgentSendEmail").on("blur",function(){$("#addAgentSendEmail").get(0).hasAttribute("disabled")||new TeG.Validator($("#addAgentSendEmail"),{cleanError:!0}).EmailIncorrectListener(TeG.Translations.ValidateInvalidFieldCheckAndTryAgain.replace(/%%field_label%%/,$("#lblForAddAgentSendEmailCheckBox").html().replace(/^s*|\*|\:|\s*$/g,""))).EmailUnsupportedCharsListener(TeG.Translations.ValidateInvalidFieldCheckAndTryAgain.replace(/%%field_label%%/,$("#lblForAddAgentSendEmailCheckBox").html().replace(/^s*|\*|\:|\s*$/g,""))).RequiredListener(TeG.Translations.ValidatePleaseInsertYourLabel.replace(/%%field_label%%/,$("#lblForAddAgentSendEmailCheckBox").html().replace(/^s*|\*|\:|\s*$/g,""))).ErrorRenderInHtml()});$("#addAgentSendEmail").removeAttr("disabled");$("#addAgentSendEmail").focus()}else $("#addAgentSendEmail").off(),$("#addAgentSendEmail").attr("disabled","disabled"),$('label[for="addAgentSendEmail"]').length&&$('label[for="addAgentSendEmail"]').html(""),$("#addAgentSendEmail").removeClass("error")});$("#addAgentSendSMSCheckBox").on("click",function(){if($("#addAgentSendSMSCheckBox").is(":checked")){$("#addAgentSendSMS").on("blur",function(){$("#addAgentSendSMS").get(0).hasAttribute("disabled")||new TeG.Validator($("#addAgentSendSMS")).MobileNumberIncorrectListener(TeG.Translations.ValidateInvalidMobileNumber).MobileNumberUnsupportedCharsListener(TeG.Translations.ValidateInvalidMobileNumber).RequiredListener(TeG.Translations.ValidateInsertMobileNumber).ErrorRenderSlideDown()});$("#addAgentSendSMS").removeAttr("disabled");$("#addAgentSendSMS").focus()}else $("#addAgentSendSMS").off(),$("#addAgentSendSMS").attr("disabled","disabled"),$('label[for="addAgentSendSMS"]').length&&$('label[for="addAgentSendSMS"]').remove(),$("#addAgentSendSMS").removeClass("error")});$("#addAgentAddButton").on("click",function(){TeG.Agents().Add().AddAgentButtonHandler()});$("#addAgentCancelButton").on("click",function(){TeG.Agents().Add().Hide()});splitterResize()}})},Hide:function(){$("#addAgent").hide();$("#addRemoveAgents").hide();$("#DivAgentsGrid").show();splitterResize()},Validate:function(){return{Common:function(){$("#addAgentFirstName").on("blur",function(){new TeG.Validator($("#addAgentFirstName")).NameUnsupportedListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#addAgentFirstNameLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).NameIncorrectListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#addAgentFirstNameLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).RequiredListener(TeG.Translations.ValidatePleaseInsertYourLabel.replace(/%%field_label%%/,$("#addAgentFirstNameLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).ErrorRenderDefault()});$("#addAgentLastName").on("blur",function(){new TeG.Validator($("#addAgentLastName")).NameUnsupportedListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#addAgentLastNameLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).NameIncorrectListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#addAgentLastNameLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).RequiredListener(TeG.Translations.ValidatePleaseInsertYourLabel.replace(/%%field_label%%/,$("#addAgentLastNameLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).ErrorRenderDefault()});$("#addAgentEmail").on("blur",function(){new TeG.Validator($("#addAgentEmail")).EmailIncorrectListener(TeG.Translations.ValidateInvalidFieldCheckAndTryAgain.replace(/%%field_label%%/,$("#addAgentEmailLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).EmailUnsupportedCharsListener(TeG.Translations.ValidateInvalidFieldCheckAndTryAgain.replace(/%%field_label%%/,$("#addAgentEmailLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).ErrorRenderDefault()});$("#addAgentMobileNumber").on("blur",function(){new TeG.Validator($("#addAgentMobileNumber")).MobileNumberIncorrectListener(TeG.Translations.ValidateInvalidFieldCheckAndTryAgain.replace(/%%field_label%%/,$("#lblAddAgentMobileNumber").html().replace(/^s*|\*|\:|\s*$/g,"")),$("#addAgentMobilePrefix").text().replace(/\s|\+/g,"")).MobileNumberUnsupportedCharsListener(TeG.Translations.ValidateInvalidFieldCheckAndTryAgain.replace(/%%field_label%%/,$("#lblAddAgentMobileNumber").html().replace(/^s*|\*|\:|\s*$/g,""))).ErrorRenderDefault()});$("#addAgentSendEmail").on("blur",function(){$("#addAgentSendEmail").get(0).hasAttribute("disabled")||new TeG.Validator($("#addAgentSendEmail"),{cleanError:!0}).EmailIncorrectListener(TeG.Translations.ValidateInvalidFieldCheckAndTryAgain.replace(/%%field_label%%/,$("#lblForAddAgentSendEmailCheckBox").html().replace(/^s*|\*|\:|\s*$/g,""))).EmailUnsupportedCharsListener(TeG.Translations.ValidateInvalidFieldCheckAndTryAgain.replace(/%%field_label%%/,$("#lblForAddAgentSendEmailCheckBox").html().replace(/^s*|\*|\:|\s*$/g,""))).RequiredListener(TeG.Translations.ValidatePleaseInsertYourLabel.replace(/%%field_label%%/,$("#lblForAddAgentSendEmailCheckBox").html().replace(/^s*|\*|\:|\s*$/g,""))).ErrorRenderInHtml()})},Password:function(){$('#addAgent[name="addAgentPassword"]').on("blur",function(){new TeG.Validator($('#addAgent[name="addAgentPassword"]')).PasswordUnsupportedListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#lblAddAgentPassword").html().replace(/\*|\:/g,""))).PasswordIncorrectListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#lblAddAgentPassword").html().replace(/\*|\:/g,""))).RequiredListener(TeG.Translations.ValidatePleaseInsertYourLabel.replace(/%%field_label%%/,$("#lblAddAgentPassword").html().replace(/\*|\:/g,""))).ErrorRenderDefault()});$('#addAgent[name="addAgentConfirmPassword"]').on("blur",function(){new TeG.Validator($('#addAgent[name="addAgentConfirmPassword"]')).PasswordUnsupportedListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#lblAddAgentPassword").html().replace(/\*|\:/g,""))).RepeatPasswordListener(TeG.Translations.ValidatePasswordNotMatch,$('#addAgent[name="addAgentPassword"]').val()).RequiredListener(TeG.Translations.ValidatePleaseInsertYourLabel.replace(/%%field_label%%/,$("#lblAddAgentConfirmPassword").html().replace(/\*|\:/g,""))).ErrorRenderDefault()})}}},AddAgentButtonHandler:function(){if($("#addAgentFirstName").blur(),$("#addAgentLastName").blur(),$("#addAgentAutoPassword").is(":checked")||($("#addAgentPassword").blur(),$("#addAgentConfirmPassword").blur()),$("#addAgentSendEmail").is(":disabled")||$("#addAgentSendEmail").blur(),$("#addAgentSendSMS").is(":disabled")||$("#addAgentSendSMS").blur(),!(new TeG.Validator).IsContainerHasDisplayedErrorMessage($("#addAgent"))){tegPopups.showDaisyWheelTotalHover();var n={firstName:$("#addAgentFirstName").val(),lastName:$("#addAgentLastName").val(),roleId:Number($("#addAgentType").val()),email:$("#addAgentEmail").val()?$("#addAgentEmail").val():null,countryId:Number($("#addAgentCountry").val()),mobilePrefix:$("#addAgentMobileNumber").val()?$("#addAgentMobilePrefix").text().replace("+",""):null,mobilePhoneNumber:$("#addAgentMobileNumber").val()?$("#addAgentMobileNumber").val():null,password:$("#addAgentAutoPassword").is(":checked")?null:$("#addAgentPassword").val(),confirmationEmail:$("#addAgentSendEmailCheckBox").is(":checked")?$("#addAgentSendEmail").val():null,confirmationMobileNumber:$("#addAgentSendSMSCheckBox").is(":checked")?$("#addAgentSendSMS").val():null};$.ajax({type:"POST",url:tegUrlHelper.addAgent,contentType:"application/json; charset=utf-8",dataType:"html",data:JSON.stringify(n),error:function(n){tegPopups.closeTotalHover();tegErrorHandler.processError(n,TeG.Translations.CashierListToolbarAddCashier)},success:function(n){n=JSON.parse(n);tegPopups.totalHoverRemoveDaisyWheel();var t=TeG.Popups().addAgent();t.phone=$("#addAgentSendSMSCheckBox").is(":checked")?$("#addAgentSendSMS").val():null;t.mail=$("#addAgentSendEmailCheckBox").is(":checked")?$("#addAgentSendEmail").val():null;t.login=n.LoginName;t.password=n.Password;t.OkButtonHandler=function(t){t.data.that.hide();TeG.Agents().Add().Hide();tegPopups.closeTotalHover();$("#GlobalSearchEdit").val(n.LoginName);$("#cancelSearch").show();!$.browser.safari||TeG.isMobile()||TeG.isIPad()||$("#cancelSearch").css("left","170px");customerAccountListManager.RefreshGrid()};cashierAddPopup.show()}})}}}},Details:function(){return{Show:function(n){$.ajax({type:"POST",url:tegUrlHelper.agentDetails,contentType:"application/json; charset=utf-8",dataType:"html",error:function(n){tegErrorHandler.processError(n)},success:function(t){var r,i,u;$("#agentDetails").html(t.replace(/(.*?\r?\n?)*?(\<.*)/,"$2"));$("#agentDetailsName").text(n);$("#detailAgentLoginName").text(n);$("#detailAgentFirstName").val($("#firstName_"+n).html());$("#detailAgentLastName").val($("#lastName_"+n).html());$("#detailAgentEmail").val($("#email_"+n).html());r=$("#AgentsGrid").data("kendoGrid")._data;i="";for(key in r)if(r[key].LoginName==n){i=r[key].PhonePrefix;break}i!=""?(i=i.replace(/\s|\+/g,""),u=new RegExp("^"+i),$("#detailAgentMobileNumber").val($.trim($("#mobilePhoneNumber_"+n).html().replace(u,"")))):$("#detailAgentMobileNumber").val($.trim($("#mobilePhoneNumber_"+n).html()));$("#detailAgentMobilePrefix").html("+"+i);$("#DivAgentsGrid").hide();$("#agentDetails").show();$("#backToAgentListFromDetails").on("click",function(){TeG.Agents().Details().Hide()});$("#detailAgentAutoPassword").on("click",function(){$("#detailAgentAutoPassword").is(":checked")?(TeG.Agents().Details().Validate().Password(),$("#detailsAgentPasswordEdit").slideDown("slow",function(){splitterResize()})):($("#detailAgentPassword").off(),$("#detailAgentConfirmPassword").off(),$("#detailsAgentPasswordEdit .errorMessage").remove(),$("#detailsAgentPasswordEdit .error").removeClass("error"),$("#detailsAgentPasswordEdit").slideUp("slow",function(){splitterResize()}))});TeG.Agents().Details().Validate().Common();$("#detailAgentSaveButton").on("click",function(){TeG.Agents().Details().SaveButtonHandler()});$("#detailAgentCancelButton").on("click",function(){TeG.Agents().Details().Hide()});splitterResize()}})},Hide:function(){$("#agentDetails").hide();$("#DivAgentsGrid").show();splitterResize()},Validate:function(){return{Common:function(){$("#detailAgentFirstName").on("blur",function(){new TeG.Validator($("#detailAgentFirstName")).NameUnsupportedListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#detailAgentFirstNameLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).NameIncorrectListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#detailAgentFirstNameLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).RequiredListener(TeG.Translations.ValidatePleaseInsertYourLabel.replace(/%%field_label%%/,$("#detailAgentFirstNameLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).ErrorRenderDefault()});$("#detailAgentLastName").on("blur",function(){new TeG.Validator($("#detailAgentLastName")).NameUnsupportedListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#detailAgentLastNameLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).NameIncorrectListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#detailAgentLastNameLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).RequiredListener(TeG.Translations.ValidatePleaseInsertYourLabel.replace(/%%field_label%%/,$("#detailAgentLastNameLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).ErrorRenderDefault()});$("#detailAgentEmail").on("blur",function(){new TeG.Validator($("#detailAgentEmail")).EmailIncorrectListener(TeG.Translations.ValidateInvalidFieldCheckAndTryAgain.replace(/%%field_label%%/,$("#detailAgentEmailLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).EmailUnsupportedCharsListener(TeG.Translations.ValidateInvalidFieldCheckAndTryAgain.replace(/%%field_label%%/,$("#detailAgentEmailLabel").html().replace(/^s*|\*|\:|\s*$/g,""))).ErrorRenderDefault()});$("#detailAgentMobileNumber").on("blur",function(){new TeG.Validator($("#detailAgentMobileNumber")).MobileNumberIncorrectListener(TeG.Translations.ValidateInvalidFieldCheckAndTryAgain.replace(/%%field_label%%/,$("#lblDetailAgentMobileNumber").html().replace(/^s*|\*|\:|\s*$/g,"")),$("#detailAgentMobilePrefix").text().replace(/\s|\+/g,"")).MobileNumberUnsupportedCharsListener(TeG.Translations.ValidateInvalidFieldCheckAndTryAgain.replace(/%%field_label%%/,$("#lblDetailAgentMobileNumber").html().replace(/^s*|\*|\:|\s*$/g,""))).ErrorRenderDefault()})},Password:function(){$("#detailAgentPassword").on("blur",function(){new TeG.Validator($("#detailAgentPassword")).PasswordUnsupportedListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#lblDetailAgentPassword").html().replace(/\*|\:/g,""))).PasswordIncorrectListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#lblDetailAgentPassword").html().replace(/\*|\:/g,""))).RequiredListener(TeG.Translations.ValidatePleaseInsertYourLabel.replace(/%%field_label%%/,$("#lblDetailAgentPassword").html().replace(/\*|\:/g,""))).ErrorRenderDefault()});$("#detailФпутеConfirmPassword").on("blur",function(){new TeG.Validator($("#detailФпутеConfirmPassword")).PasswordUnsupportedListener(TeG.Translations.ValidateInsertFieldInCorrectFormat.replace(/%%field_label%%/,$("#lblDetailФпутеConfirmPassword").html().replace(/\*|\:/g,""))).RepeatPasswordListener(TeG.Translations.ValidatePasswordNotMatch,$("#detailФпутеPassword").val()).RequiredListener(TeG.Translations.ValidatePleaseInsertYourLabel.replace(/%%field_label%%/,$("#lblDetailФпутеConfirmPassword").html().replace(/\*|\:/g,""))).ErrorRenderDefault()})}}},SaveButtonHandler:function(){if($("#detailAgentFirstName").blur(),$("#detailAgentLastName").blur(),$("#detailAgentEmail").blur(),$("#detailAgentMobileNumber").blur(),$("#detailAgentAutoPassword").is(":checked")&&($("#detailAgentPassword").blur(),$("#detailAgentConfirmPassword").blur()),!(new TeG.Validator).IsContainerHasDisplayedErrorMessage($("#agentDetails"))){tegPopups.showDaisyWheelTotalHover();var n={loginName:$("#detailAgentLoginName").text(),firstName:$("#detailAgentFirstName").val(),lastName:$("#detailAgentLastName").val(),email:$("#detailAgentEmail").val(),mobilePhoneNumber:$.trim($("#detailAgentMobileNumber").val())!=""?$("#detailAgentMobilePrefix").text().replace(/\+|\s/g,"")+$.trim($("#detailAgentMobileNumber").val()):"",password:$("#detailAgentAutoPassword").is(":checked")?$("#detailAgentPassword").val():null,confirmationEmail:null,confirmationMobileNumber:null};$.ajax({type:"POST",url:tegUrlHelper.agentDetailsUpdate,contentType:"application/json; charset=utf-8",dataType:"html",data:JSON.stringify(n),error:function(n){tegPopups.closeTotalHover();tegErrorHandler.processError(n,"Error")},success:function(){tegPopups.closeTotalHover();TeG.Agents().Details().Hide();customerAccountListManager.RefreshGrid(),function n(){$("#firstName_"+$("#detailAgentLoginName").text()).length>0&&$(".k-detail-row").length==0?$("#firstName_"+$("#detailAgentLoginName").text()).parent().addClass("k-state-selected"):setTimeout(n,250)}()}})}}}},List:function(){return{OnNestedContentLoad:function(){var n=$("#AgentsGrid").data("kendoGrid"),t=n.dataItem(n.select());-1!=$("#status_"+t.LoginName).html().indexOf("statusLocked")&&$("#lockUnLockRef_"+t.LoginName).focus();$("body").trigger("NestedContentLoaded")}}}}}