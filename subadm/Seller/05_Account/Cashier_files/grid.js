var TeG=TeG||{};(function(){$(document).on("NestedContentLoaded","body",function(){$("table.user_func button span.visibleMsg").addClass(culture);$("div.contact.enabled button.change").addClass(culture)});$(document).on("MemberDetailsActionTabLoaded","body",function(){$("table.user_func button span.visibleMsg").addClass(culture);$("div.contact.enabled button.change").addClass(culture)})})();TeG.Grid=function(n,t){this.grid=n;this.gridId=n.element[0].id;this.globalSearchJElem=$("#GlobalSearchEdit");t&&(this.reportParametersHashCode=typeof getReportParametersHashCode=="function"?getReportParametersHashCode().reportParametersHashCode:"");this.reportParametersHashCode=t?t:"";this.uniqueColumnName="";this.refreshSelectExpand=function(){var t,i,r,u,n;if(this.uniqueColumnName){t=0;n=this.grid;for(i in this.grid.columns)if(this.grid.columns[i].field==this.uniqueColumnName){t=1+Number(i);break}r=this.grid.select().find("td").eq(t).html();this.grid.dataSource.fetch(function(){for(var u=n.tbody.find(">tr:not(.k-grouping-row)"),i=0;i<u.length;i++)if(r==u.eq(i).find("td").eq(t).html()){n.select(u.eq(i));break}})}else u=this.grid.select()[0].rowIndex,n=this.grid,this.grid.dataSource.fetch(function(){var t=n.tbody.find(">tr:not(.k-grouping-row)").eq(u);n.select(t)})};this.refresh=function(){var r=[],t,i,u,f;if(this.grid.dataSource.filter()!=null){for(t=this.grid.dataSource.filter().filters.length-1;t>=0;t--)this.grid.dataSource.filter().filters[t].field==TeG.GlobalVariables.GlobalSearchFieldName&&this.grid.dataSource.filter().filters.splice(t,1);r=this.grid.dataSource.filter().filters}i=this.globalSearchJElem.val();u=this.globalSearchJElem.attr("default-value");try{localStorage.setItem(TeG.GlobalVariables.GlobalSearchCacheKey+this.gridId,i)}catch(e){}i!=""&&i!=u&&(f={field:TeG.GlobalVariables.GlobalSearchFieldName,operator:"contains",value:i},r.push(f));n.dataSource.filter(r)};this.addSearchBehaivor=function(n,t,i){t||(t=$("#cancelSearch"));n||(n=this.refresh);i||this.globalSearchJElem.off();this.globalSearchJElem.on("focus",function(){$(this).attr("background","url(../Images/searchYellow.png) no-repeat;");$(this).val()==TeG.Translations.GridPanelSearch&&($(this).val(""),$(this).removeClass("globalSearchInputDefault"))});this.globalSearchJElem.on("blur",{that:this},function(n){that=n.data.that;$(this).attr("background","url(../Images/search.png) no-repeat;");$.trim($(this).val())==""&&($(this).val(TeG.Translations.GridPanelSearch),$(this).addClass("globalSearchInputDefault"));existedGridFilter=that.getExistedFilter();existedGridFilter&&($(this).val(existedGridFilter),$("#cancelSearch").show(),!$.browser.safari||TeG.isMobile()||TeG.isIPad()||$("#cancelSearch").css("left","170px"))});this.globalSearchJElem.on("keydown",{that:this},function(t){var i=t.which||t.keyCode;i==13&&typeof n=="function"&&n.call(t.data.that)});this.globalSearchJElem.on("keyup",function(){var n=$.trim($(this).val());n!=""&&n!=TeG.Translations.CustomerAccountListGridPanelSearch?($("#cancelSearch").css("display","block"),!$.browser.safari||TeG.isMobile()||TeG.isIPad()||$("#cancelSearch").css("left","170px")):$("#cancelSearch").css("display","none")});$.trim(this.globalSearchJElem.val())!=""&&$.trim(this.globalSearchJElem.val())!=TeG.Translations.CustomerAccountListGridPanelSearch&&t.show();i||t.off();t.on("click",{that:this},function(t){$(this).hide();t.data.that.globalSearchJElem.val("").focus();typeof n=="function"&&n.call(t.data.that)})};this.clickRow=function(){if(this.grid.select()&&this.grid.select()[0]&&$.isNumeric(n.select()[0].rowIndex)){var i=this.grid.select()[0].rowIndex,t=this.grid.tbody.find(">tr:not(.k-grouping-row)").eq(i);!t.hasClass("k-state-selected")||t.eq(0).next()&&t.eq(0).next().hasClass("k-detail-row")&&!(t.eq(0).next().filter(":visible").length==0)?this.grid.collapseRow(t):(this.grid.collapseRow(n.tbody.find(">tr.k-detail-row:visible").eq(0).prev()),$("#"+this.gridId).find("tr.k-detail-row").remove(),this.grid.expandRow(t))}};this.addColumnOrderBehaivor=function(){var n=this;typeof n.grid._events.columnHide=="undefined"&&(n.grid._events.columnHide=[]);n.grid._events.columnHide.push(function(){n.storeColumns.call(n)});typeof n.grid._events.columnReorder=="undefined"&&(n.grid._events.columnReorder=[]);n.grid._events.columnReorder.push(function(){n.storeColumns.call(n)});typeof n.grid._events.columnShow=="undefined"&&(n.grid._events.columnShow=[]);n.grid._events.columnShow.push(function(){n.storeColumns.call(n)})};this.addColumnOrderBehaivorDrillDown=function(n){var t=this;typeof t.grid._events.columnHide=="undefined"&&(t.grid._events.columnHide=[]);t.grid._events.columnHide.push(function(){t.storeColumns.call(t)});typeof t.grid._events.columnReorder=="undefined"&&(t.grid._events.columnReorder=[]);t.grid._events.columnReorder.push(function(){t.storeColumnsDrillDown.call(t,n)});typeof t.grid._events.columnShow=="undefined"&&(t.grid._events.columnShow=[]);t.grid._events.columnShow.push(function(){t.storeColumns.call(t)})};this.storeColumnWidth=function(n){var i=this.element.attr("id"),t;window.sessionStorage&&(t=JSON.parse(sessionStorage.getItem("gridColumnsState")||"{}"),t[i]=t[i]||{},t[i][n.column.field]=t[i][n.column.field]||null,t[i][n.column.field]=n.newWidth,sessionStorage.setItem("gridColumnsState",JSON.stringify(t)))};this.restoreColumnsWidth=function(){var t=$(String.format("#{0}",this.gridId)),f=t.find('div.k-grid-header>div.k-grid-header-wrap>table[role="grid"]>thead[role="rowgroup"]>tr[role="row"]'),o=t.find("div.k-grid-content>table>tbody>tr.k-master-row"),i,n;if(window.sessionStorage&&(i=JSON.parse(sessionStorage.getItem("gridColumnsState")||"{}"),n=i[this.gridId]||{},!$.isEmptyObject(n))){for(column in n){var e=f.find(String.format('[data-field="{0}"]',column)),r=n[column],u=$(e).index();$("div.k-grid-header table col").eq(u).width(r);$("div.k-grid-content table col").eq(u).width(r)}$("div.k-grid-header table col").last().removeAttr("style");$("div.k-grid-content table col").last().removeAttr("style")}};this.getSelectedRowData=function(){if(this.grid.select().length==0)throw"TeG.MemberParent.getSelectedRowLogin: Row must be selected";else if(this.grid.select().length>1)throw"TeG.MemberParent.getSelectedRowLogin: method does not work in multiselect mode";return this.grid.dataSource.at(this.grid.select()[0].rowIndex)};this.getConfiguration=function(){var n=null;return $.ajax({url:tegUrlHelper.GetGridConfiguration+"?gridName="+this.gridId,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",async:!1}).done(function(t){n=t}),n};this.storeColumns=function(){};this.storeColumnsDrillDown=function(n){var t=this;setTimeout(function(){var r=t.getConfiguration(),i=[],f=r.fields,u;($("#"+t.gridId).find(".k-header").each(function(){f[$(this).attr("data-field")]&&i.push({ColumnName:$(this).attr("data-field"),IsVisible:$(this).css("display")!="none"})}),u=r.name,n&&($.isArray(n)||(n=[n]),-1==n.indexOf(i[0].ColumnName)))||$.ajax({url:tegUrlHelper.StoreGridColumnsOrder,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({gridType:u,columnNames:i,reportParametersHashCode:t.reportParametersHashCode})})},50)};this.cleanColumnsOrder=function(){var n=that.getConfiguration(),t=n.name;$.ajax({url:tegUrlHelper.ClearGridColumnsOrder,async:!1,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({gridType:t,reportParametersHashCode:that.reportParametersHashCode})})};this.onBound=function(){var n=this;$("#body-pane-loader").hide();$("#body-pane-content").show();TeG.isMobile()||tegKeyboardNavigation.Init();TeG.kendoGridManager();splitterResize();n.markFilter()};this.markFilterOnBound=function(){var n=this;n.grid._events.dataBound.push(function(){n.markFilter.call(n)})};this.markFilter=function(){function t(i){for(key1 in i){key1=="filters"&&t(i[key1]);for(key2 in i[key1])key2=="filters"?t(i[key1][key2]):key2=="field"&&n.grid.thead.find('th[data-field="'+i[key1].field+'"]').find("span").removeClass("k-icon").removeClass("k-i-arrowhead-s").addClass("filtering_funnel")}}var n=this;n.grid.thead.find(".k-header-column-menu").find("span").removeClass("filtering_funnel").addClass("k-icon").addClass("k-i-arrowhead-s");t(n.grid.dataSource.filter())};this.getExistedFilter=function(){if(this.grid.dataSource._filter){var n=this.grid.dataSource._filter.filters;for(key in n)if(n[key].field=="GlobalSearchCondition"&&n[key].operator=="contains")return n[key].value;return}}};TeG.Grid.NOT_DESTROY_PREVIOUSE_SEARCH=!0;TeG.Grid.Options={Store:function(n){var r=n.sender.element.attr("id"),u=n.sender.element.data("kendoGrid"),t={},i;$.extend(t,u.getOptions());$(t.columns).each(function(){this.width=parseInt(this.width)+"px"});n.oldIndex!=null&&n.newIndex!=null&&(i=t.columns.splice(n.oldIndex,1),t.columns.splice(n.newIndex,0,i[0]));try{sessionStorage.setItem(r+"_"+culture+"_grid_options",kendo.stringify(t))}catch(f){}},Restore:function(n,t){var c=n.element.attr("id"),i,r,h,o,f,e,s,w,b,u,l,a;n||(n=$('div[data-role="grid"]').data("kendoGrid"));try{i=sessionStorage.getItem(c+"_"+culture+"_grid_options")}catch(k){return}if(r=n.getOptions(),i=JSON.parse(i),i){if(i.columns.length>r.columns.length){for(h=0;h<r.columns.length;h++)for(o=0;o<i.columns.length;o++)if(r.columns[h].field==i.columns[o].field){r.columns[h].format!=i.columns[o].format&&(i.columns[o]=r.columns[h]);i.columns[o].existsInGridOptions=!0;break}for(f=0;f<i.columns.length;f++)i.columns[f]&&!i.columns[f].existsInGridOptions&&(i.columns.splice(f,1),f--),i.columns[f]&&delete i.columns[f].existsInGridOptions}if(i.columns.length<r.columns.length){for(e=0;e<r.columns.length;e++)for(s=0;s<i.columns.length;s++)if(r.columns[e].field==i.columns[s].field){r.columns[e].format!=i.columns[s].format&&(i.columns[s]=r.columns[e]);for(prop in r.columns[e])r.columns[e][prop]=i.columns[s][prop]}i.columns=r.columns}if(i.columns.length==r.columns.length){var v=$.extend([],r.columns),y=$.extend([],i.columns),p=function(n,t){return n.field<t.field?-1:n.field==t.field?0:n.field>t.field?1:void 0};if(v.sort(p),y.sort(p),w=$.map(v,function(n){return n.field+"_"+n.format}).join(" "),b=$.map(y,function(n){return n.field+"_"+n.format}).join(" "),w!==b)for(u=0;u<r.columns.length;u++)r.columns[u].field!=i.columns[u].field?i.columns[u]=r.columns[u]:r.columns[u].format!=i.columns[u].format&&(i.columns[u].format=r.columns[u].format)}r.columns=i.columns}t&&(r.toolbar=t);n.setOptions(r);!$.browser.safari||TeG.isMobile()||TeG.isIPad()||$("#cancelSearch").css("left","170px");l=$("th:last","div#"+c).data("kendoDropTarget");l&&l.destroy();a=$("div#"+c).data("kendoDraggable");a&&a.bind("dragstart",function(n){n.currentTarget.text()===""&&n.preventDefault()});$(window).resize(function(){$(".empty-table-part").length>0&&$("td.fake-column").length>0&&$(".empty-table-part").width($("td.fake-column").outerWidth())})},Update:{Column:function(n,t){var r=n.element.attr("id"),i=sessionStorage.getItem(r+"_"+culture+"_grid_options");i=JSON.parse(i);i&&typeof i.dataSource.fields!="undefined"&&typeof i.columns!="undefined"&&($.each(t,function(n,t){$.each(i.dataSource.fields,function(n){i.dataSource.fields[n].field==t.field&&(i.dataSource.fields[n][t.attr]=t.value,i.columns[n][t.attr]=t.value,typeof i.dataSource.fields[n].attributes!="undefined"&&typeof i.columns[n].attributes!="undefined"&&(i.dataSource.fields[n].attributes.style=t.style,i.columns[n].attributes.style=t.style),typeof i.dataSource.fields[n].footerAttributes!="undefined"&&typeof i.columns[n].footerAttributes!="undefined"&&(i.dataSource.fields[n].footerAttributes.style=t.style,i.columns[n].footerAttributes.style=t.style),typeof i.dataSource.fields[n].headerAttributes!="undefined"&&typeof i.columns[n].headerAttributes!="undefined"&&(i.dataSource.fields[n].headerAttributes.style=t.style,i.columns[n].headerAttributes.style=t.style))})}),sessionStorage.setItem(r+"_"+culture+"_grid_options",kendo.stringify(i)))}}};TeG.Grid.BindingEvents={DblClickOnRezizeHandle:function(){$(".k-grid").bind("dblclick",".k-resize-handle",function(){$("td.empty-table-part").length>0&&$("td.empty-table-part").width($("td.fake-column").outerWidth())})}}